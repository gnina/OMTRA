from rdkit import Chem

ph_idx_to_type = [
    "Aromatic",
    "HydrogenDonor",
    "HydrogenAcceptor",
    "PositiveIon",
    "NegativeIon",
    "Hydrophobic",
    "Halogen",
]
charge_map = [-3, -2, -1, 0, 1, 2, 3, 4, 5, 6]

ph_type_to_idx = {val: idx for idx, val in enumerate(ph_idx_to_type)}

protein_element_map = [
    "C",
    "O",
    "N",
    "S",
    "P",
    "F",
    "H",
    "AS",
    "B",
    "SE",
    "CL",
    "X",
    "I",
    "NE",
    "HG",
    "D",
    "BR",
    "V",
    "BE",
]

bond_type_map = [None, Chem.rdchem.BondType.SINGLE, Chem.rdchem.BondType.DOUBLE, Chem.rdchem.BondType.TRIPLE,
             Chem.rdchem.BondType.AROMATIC, None]

lig_atom_type_map = ["C", "H", "N", "O", "F", "P", "S", "Cl", "Br", "I", "B"]
npnde_atom_type_map = [
    "C",
    "N",
    "O",
    "S",
    "F",
    "P",
    "Cl",
    "Br",
    "I",
    "Si",
    "Pd",
    "Ca",
    "Sc",
    "Al",
    "Pt",
    "Cr",
    "Rh",
    "Mo",
    "Y",
    "Cu",
    "Sm",
    "Bi",
    "Ir",
    "Be",
    "Pb",
    "Kr",
    "As",
    "Sn",
    "Lu",
    "Co",
    "Ni",
    "K",
    "Am",
    "Rb",
    "Gd",
    "Ce",
    "Ba",
    "Au",
    "Na",
    "Th",
    "Pr",
    "Yb",
    "Ti",
    "Mg",
    "Sr",
    "Cs",
    "Tl",
    "B",
    "Xe",
    "Cm",
    "Li",
    "Zr",
    "Cf",
    "Ag",
    "Cd",
    "Mn",
    "Eu",
    "In",
    "Hg",
    "W",
    "Tb",
    "La",
    "Sb",
    "Te",
    "Se",
    "Zn",
    "Os",
    "Ga",
    "Fe",
    "Nd",
    "Pu",
    "V",
    "U",
    "Ru",
    "Re",
]

residue_map = [
    "ALA",
    "ILE",
    "TRP",
    "VAL",
    "LYS",
    "ASN",
    "PHE",
    "GLN",
    "SER",
    "GLU",
    "CYS",
    "PRO",
    "GLY",
    "HIS",
    "TYR",
    "ASP",
    "THR",
    "MET",
    "LEU",
    "ARG",
    "UNK", # for unkown residue types
]

residue_to_single = {
    "ALA": "A",
    "ILE": "I",
    "TRP": "W",
    "VAL": "V",
    "LYS": "K",
    "ASN": "N",
    "PHE": "F",
    "GLN": "Q",
    "SER": "S",
    "GLU": "E",
    "CYS": "C",
    "PRO": "P",
    "GLY": "G",
    "HIS": "H",
    "TYR": "Y",
    "ASP": "D",
    "THR": "T",
    "MET": "M",
    "LEU": "L",
    "ARG": "R",
    "UNK": "_",
}

# Taken from DrugFlow aa_atom_index
# https://github.com/LPDI-EPFL/DrugFlow/blob/5ad8cd0b2afd6549f21527acc0e00a71a3b7b8db/src/constants.py#L60
protein_atom_map = [
    "CE2",
    "O",
    "CD2",
    "CZ3",
    "CG1",
    "ND2",
    "OE2",
    "NH1",
    "CG",
    "CE3",
    "N",
    "OD1",
    "CD1",
    "CG2",
    "SD",
    "NE",
    "OG",
    "CE1",
    "CZ",
    "NE2",
    "NZ",
    "CA",
    "OH",
    "OG1",
    "CD",
    "SG",
    "NE1",
    "CZ2",
    "OE1",
    "ND1",
    "CB",
    "CH2",
    "CE",
    "C",
    "NH2",
    "OD2",
    "UNK",
]


# cite pdbfixer here
# https://github.com/openmm/pdbfixer/blob/5a6c129fb5b508610542634eafa218fb0e0671fe/pdbfixer/pdbfixer.py#L68
aa_substitutions = {
    "2AS": "ASP",
    "3AH": "HIS",
    "5HP": "GLU",
    "5OW": "LYS",
    "ACL": "ARG",
    "AGM": "ARG",
    "AIB": "ALA",
    "ALM": "ALA",
    "ALO": "THR",
    "ALY": "LYS",
    "ARM": "ARG",
    "ASA": "ASP",
    "ASB": "ASP",
    "ASK": "ASP",
    "ASL": "ASP",
    "ASQ": "ASP",
    "AYA": "ALA",
    "BCS": "CYS",
    "BHD": "ASP",
    "BMT": "THR",
    "BNN": "ALA",
    "BUC": "CYS",
    "BUG": "LEU",
    "C5C": "CYS",
    "C6C": "CYS",
    "CAS": "CYS",
    "CCS": "CYS",
    "CEA": "CYS",
    "CGU": "GLU",
    "CHG": "ALA",
    "CLE": "LEU",
    "CME": "CYS",
    "CSD": "ALA",
    "CSO": "CYS",
    "CSP": "CYS",
    "CSS": "CYS",
    "CSW": "CYS",
    "CSX": "CYS",
    "CXM": "MET",
    "CY1": "CYS",
    "CY3": "CYS",
    "CYG": "CYS",
    "CYM": "CYS",
    "CYQ": "CYS",
    "DAH": "PHE",
    "DAL": "ALA",
    "DAR": "ARG",
    "DAS": "ASP",
    "DCY": "CYS",
    "DGL": "GLU",
    "DGN": "GLN",
    "DHA": "ALA",
    "DHI": "HIS",
    "DIL": "ILE",
    "DIV": "VAL",
    "DLE": "LEU",
    "DLY": "LYS",
    "DNP": "ALA",
    "DPN": "PHE",
    "DPR": "PRO",
    "DSN": "SER",
    "DSP": "ASP",
    "DTH": "THR",
    "DTR": "TRP",
    "DTY": "TYR",
    "DVA": "VAL",
    "EFC": "CYS",
    "FLA": "ALA",
    "FME": "MET",
    "GGL": "GLU",
    "GL3": "GLY",
    "GLZ": "GLY",
    "GMA": "GLU",
    "GSC": "GLY",
    "HAC": "ALA",
    "HAR": "ARG",
    "HIC": "HIS",
    "HIP": "HIS",
    "HMR": "ARG",
    "HPQ": "PHE",
    "HTR": "TRP",
    "HYP": "PRO",
    "IAS": "ASP",
    "IIL": "ILE",
    "IYR": "TYR",
    "KCX": "LYS",
    "LLP": "LYS",
    "LLY": "LYS",
    "LTR": "TRP",
    "LYM": "LYS",
    "LYZ": "LYS",
    "MAA": "ALA",
    "MEN": "ASN",
    "MHS": "HIS",
    "MIS": "SER",
    "MK8": "LEU",
    "MLE": "LEU",
    "MPQ": "GLY",
    "MSA": "GLY",
    "MSE": "MET",
    "MVA": "VAL",
    "NEM": "HIS",
    "NEP": "HIS",
    "NLE": "LEU",
    "NLN": "LEU",
    "NLP": "LEU",
    "NMC": "GLY",
    "OAS": "SER",
    "OCS": "CYS",
    "OMT": "MET",
    "PAQ": "TYR",
    "PCA": "GLU",
    "PEC": "CYS",
    "PHI": "PHE",
    "PHL": "PHE",
    "PR3": "CYS",
    "PRR": "ALA",
    "PTR": "TYR",
    "PYX": "CYS",
    "SAC": "SER",
    "SAR": "GLY",
    "SCH": "CYS",
    "SCS": "CYS",
    "SCY": "CYS",
    "SEL": "SER",
    "SEP": "SER",
    "SET": "SER",
    "SHC": "CYS",
    "SHR": "LYS",
    "SMC": "CYS",
    "SOC": "CYS",
    "STY": "TYR",
    "SVA": "SER",
    "TIH": "ALA",
    "TPL": "TRP",
    "TPO": "THR",
    "TPQ": "ALA",
    "TRG": "LYS",
    "TRO": "TRP",
    "TYB": "TYR",
    "TYI": "TYR",
    "TYQ": "TYR",
    "TYS": "TYR",
    "TYY": "TYR",
}

_DEFAULT_DISTANCE_RANGE = {
    # Taken from Biotite Python
    # Taken from Allen et al.
    #               min   - 2*std     max   + 2*std
    ("B", "C"): (1.556 - 2 * 0.015, 1.556 + 2 * 0.015),
    ("BR", "C"): (1.875 - 2 * 0.029, 1.966 + 2 * 0.029),
    ("BR", "O"): (1.581 - 2 * 0.007, 1.581 + 2 * 0.007),
    ("C", "C"): (1.174 - 2 * 0.011, 1.588 + 2 * 0.025),
    ("C", "CL"): (1.713 - 2 * 0.011, 1.849 + 2 * 0.011),
    ("C", "F"): (1.320 - 2 * 0.009, 1.428 + 2 * 0.009),
    ("C", "H"): (1.059 - 2 * 0.030, 1.099 + 2 * 0.007),
    ("C", "I"): (2.095 - 2 * 0.015, 2.162 + 2 * 0.015),
    ("C", "N"): (1.325 - 2 * 0.009, 1.552 + 2 * 0.023),
    ("C", "O"): (1.187 - 2 * 0.011, 1.477 + 2 * 0.008),
    ("C", "P"): (1.791 - 2 * 0.006, 1.855 + 2 * 0.019),
    ("C", "S"): (1.630 - 2 * 0.014, 1.863 + 2 * 0.015),
    ("C", "SE"): (1.893 - 2 * 0.013, 1.970 + 2 * 0.032),
    ("C", "SI"): (1.837 - 2 * 0.012, 1.888 + 2 * 0.023),
    ("CL", "O"): (1.414 - 2 * 0.026, 1.414 + 2 * 0.026),
    ("CL", "P"): (1.997 - 2 * 0.035, 2.008 + 2 * 0.035),
    ("CL", "S"): (2.072 - 2 * 0.023, 2.072 + 2 * 0.023),
    ("CL", "SI"): (2.072 - 2 * 0.009, 2.072 + 2 * 0.009),
    ("F", "N"): (1.406 - 2 * 0.016, 1.406 + 2 * 0.016),
    ("F", "P"): (1.495 - 2 * 0.016, 1.579 + 2 * 0.025),
    ("F", "S"): (1.640 - 2 * 0.011, 1.640 + 2 * 0.011),
    ("F", "SI"): (1.588 - 2 * 0.014, 1.694 + 2 * 0.013),
    ("H", "N"): (1.009 - 2 * 0.022, 1.033 + 2 * 0.022),
    ("H", "O"): (0.967 - 2 * 0.010, 1.015 + 2 * 0.017),
    ("I", "O"): (2.144 - 2 * 0.028, 2.144 + 2 * 0.028),
    ("N", "N"): (1.124 - 2 * 0.015, 1.454 + 2 * 0.021),
    ("N", "O"): (1.210 - 2 * 0.011, 1.463 + 2 * 0.012),
    ("N", "P"): (1.571 - 2 * 0.013, 1.697 + 2 * 0.015),
    ("N", "S"): (1.541 - 2 * 0.022, 1.710 + 2 * 0.019),
    ("N", "SI"): (1.711 - 2 * 0.019, 1.748 + 2 * 0.022),
    ("O", "P"): (1.449 - 2 * 0.007, 1.689 + 2 * 0.024),
    ("O", "S"): (1.423 - 2 * 0.008, 1.580 + 2 * 0.015),
    ("O", "SI"): (1.622 - 2 * 0.014, 1.680 + 2 * 0.008),
    ("P", "P"): (2.214 - 2 * 0.022, 2.214 + 2 * 0.022),
    ("P", "S"): (1.913 - 2 * 0.014, 1.954 + 2 * 0.005),
    ("P", "SE"): (2.093 - 2 * 0.019, 2.093 + 2 * 0.019),
    ("P", "SI"): (2.264 - 2 * 0.019, 2.264 + 2 * 0.019),
    ("S", "S"): (1.897 - 2 * 0.012, 2.070 + 2 * 0.022),
    ("S", "SE"): (2.193 - 2 * 0.015, 2.193 + 2 * 0.015),
    ("S", "SI"): (2.145 - 2 * 0.020, 2.145 + 2 * 0.020),
    ("SE", "SE"): (2.340 - 2 * 0.024, 2.340 + 2 * 0.024),
    ("SI", "SE"): (2.359 - 2 * 0.012, 2.359 + 2 * 0.012),
}
